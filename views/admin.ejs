<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin</title>
</head>
<body>
  <h1>Liste des admin</h1>
  <table border="1">
    <thead>
      <tr>
        <th colspan="3">Administrateur</th>
      </tr>
    </thead>
    <tr>
      <th>Username :</th>
      <th> Autorisation :</th>
    
      
      <th>Action</th>

    </tr>
  
    <% for (const user of admins) { %>
      <form action="/authAdmin" method="post" name="authForm">
        <tr>
          <th><%= user.username %></th>
          <th>
            <% if(current_authLevel >= auth_changer_authLevel && user.authLevel<100 ){  %>
            <select name="authVal">
              
              <option value="1" <%= user.authLevel === 1 ? 'selected' : '' %>>1</option>
              <option value="2" <%= user.authLevel === 2 ? 'selected' : '' %>>2</option>
              <option value="3" <%= user.authLevel === 3 ? 'selected' : '' %>>3</option>
            </select>
            <% } else{  %>
              <%= user.authLevel %>
            <% } %>
          </th>
          <% if(current_authLevel >= auth_supprimer_admin && user.authLevel<100 ){  %></100>
          <th>
            <input type="hidden" name="usernameToChangeAuthLevel" value="<%= user.username %>">
            <button type="button" onclick="deleteAdmin('<%= user.username %>')">-</button>
          </th>
          <% } %>
        </tr>
      </form>
    <% } %>
    <tr>
      <th><input type="text" placeholder="username"></th>
      
      
      <th><select id="authVal">
          <option value="1" selected >1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select></th>
        <th><button>+</button></th>
  </tr>
  
  </table>
    
  <script>
    function deleteAdmin(username) {
      if (confirm(`Voulez-vous vraiment supprimer l'admin ${username} ?`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/deleteAdmin';
        form.style.display = 'none';
  
        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'usernameAdminToDelete';
        input.value = username;
        form.appendChild(input);
  
        document.body.appendChild(form);
        form.submit();
      }
    }
  </script>
  
</body>
</html>